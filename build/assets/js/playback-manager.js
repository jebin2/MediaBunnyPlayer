class PlaybackManager{constructor(){this.isPlaying=!1,this.animationFrameId=null,this.lastTime=0,this.init()}init(){window.addEventListener("timeline-play-toggle",()=>this.togglePlay()),console.log("PlaybackManager initialized")}togglePlay(){this.isPlaying?this.pause():this.play()}async play(){if(this.isPlaying)return;const i=window.previewPlayer;if(i)try{await i.play(),this.isPlaying=!0,this.startLoop(),this.dispatchStateChange()}catch(i){console.error("Failed to play:",i)}else console.warn("PreviewPlayer not found")}pause(){if(!this.isPlaying)return;const i=window.previewPlayer;i&&i.pause(),this.isPlaying=!1,this.stopLoop(),this.dispatchStateChange(),this.updateSync()}seek(i){const a=window.previewPlayer,t=window.timelineManager;a&&a.seek(i),t&&(t.updatePlayheadPosition(i),t.updateTime(i))}startLoop(){const i=()=>{this.updateSync(),this.isPlaying&&(this.animationFrameId=requestAnimationFrame(i))};this.animationFrameId=requestAnimationFrame(i)}stopLoop(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}updateSync(){const i=window.previewPlayer,a=window.timelineManager,t=window.clipManager;if(!i||!a)return;const e=i.getCurrentTime(),n=t?t.projectDuration:60;a.updatePlayheadPosition(e),a.updateTime(e),e>=n&&this.isPlaying&&(this.pause(),this.seek(0))}dispatchStateChange(){const i=new CustomEvent("preview-player-state-change",{detail:{isPlaying:this.isPlaying}});window.dispatchEvent(i)}}window.playbackManager=new PlaybackManager;export default window.playbackManager;