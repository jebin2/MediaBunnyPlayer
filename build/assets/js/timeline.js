class TimelineManager{constructor(){this.playBtn=document.getElementById("timeline-play-btn"),this.currentTimeDisplay=document.getElementById("timeline-current-time"),this.totalDurationDisplay=document.getElementById("timeline-total-duration"),this.zoomOutBtn=document.getElementById("timeline-zoom-out"),this.zoomInBtn=document.getElementById("timeline-zoom-in"),this.zoomLevelDisplay=document.getElementById("timeline-zoom-level"),this.settingsBtn=document.getElementById("timeline-settings-btn"),this.ruler=document.querySelector(".timeline__ruler"),this.trackContainer=document.getElementById("timeline-tracks"),this.zoomLevel=100,this.isPlaying=!1,this.duration=60,this.pixelsPerSecond=50,this.tracks=[],this.init()}init(){this.attachEventListeners(),this.createTrackContainer(),this.updateRuler(),this.syncHorizontalScroll(),console.log("TimelineManager initialized")}createTrackContainer(){this.trackContainer&&(this.trackContainer.innerHTML="",this.tracks=[],this.addTrack("video","Video Track 1"),this.addTrack("video","Video Track 2"),this.addTrack("audio","Audio Track 1"))}addTrack(e,t){const i=`track-${this.tracks.length+1}`,n=document.createElement("div");n.className=`timeline-track timeline-track--${e}`,n.dataset.trackId=i,n.dataset.trackType=e,n.dataset.empty="true",n.dataset.emptyText="Drag media here";const a=document.createElement("div");a.className="timeline-track__header";const l=document.createElement("div");l.className="timeline-track__info";const o=document.createElement("span");o.className="timeline-track__icon",o.textContent="video"===e?"ðŸŽ¬":"ðŸŽµ";const s=document.createElement("span");s.className="timeline-track__name",s.textContent=t,s.title=t,l.appendChild(o),l.appendChild(s);const r=document.createElement("div");r.className="timeline-track__controls";const c=document.createElement("button");c.className="track-btn",c.innerHTML="ðŸ”‡",c.title="Mute";const d=document.createElement("button");d.className="track-btn",d.innerHTML="S",d.title="Solo";const m=document.createElement("button");m.className="track-btn",m.innerHTML="ðŸ”’",m.title="Lock",r.appendChild(c),r.appendChild(d),r.appendChild(m),a.appendChild(l),a.appendChild(r);const h=document.createElement("div");h.className="timeline-track__content",n.appendChild(a),n.appendChild(h),this.trackContainer.appendChild(n),this.tracks.push({id:i,type:e,name:t,element:n}),this.updateTrackWidth()}updateRuler(){if(this.ruler){const e=this.calculateWidth();let t=this.ruler.querySelector(".timeline__ruler-content");t||(t=document.createElement("div"),t.className="timeline__ruler-content",t.style.height="100%",this.ruler.appendChild(t)),t.style.width=`${e}px`,this.generateTimeMarkers(t),this.updateTrackWidth()}}calculateWidth(){return this.duration*this.pixelsPerSecond*(this.zoomLevel/100)}updateTrackWidth(){const e=this.calculateWidth();document.querySelectorAll(".timeline-track__content").forEach(t=>{t.style.width=`${e}px`})}generateTimeMarkers(e){e.innerHTML="";const t=this.zoomLevel/100,i=this.pixelsPerSecond*t;let n=5,a=1;i<20?(n=10,a=5):i<10&&(n=30,a=10);const l=document.createDocumentFragment();for(let e=0;e<=this.duration;e+=a){const t=e*i;if(e%n===0){const i=document.createElement("div");i.className="timeline__marker",i.style.left=`${t}px`;const n=document.createElement("span");n.className="timeline__label",n.textContent=this.formatTimeLabel(e),i.appendChild(n);const a=document.createElement("div");a.className="timeline__tick timeline__tick--major",i.appendChild(a),l.appendChild(i)}else{const e=document.createElement("div");e.className="timeline__marker",e.style.left=`${t}px`;const i=document.createElement("div");i.className="timeline__tick timeline__tick--minor",e.appendChild(i),l.appendChild(e)}}e.appendChild(l)}syncHorizontalScroll(){if(!this.ruler||!this.trackContainer)return;let e=!1,t=!1;this.ruler.addEventListener("scroll",()=>{e||(t=!0,this.trackContainer.scrollLeft=this.ruler.scrollLeft),e=!1}),this.trackContainer.addEventListener("scroll",()=>{t||(e=!0,this.ruler.scrollLeft=this.trackContainer.scrollLeft),t=!1})}formatTimeLabel(e){return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}attachEventListeners(){this.zoomOutBtn&&this.zoomOutBtn.addEventListener("click",()=>this.handleZoom(-25)),this.zoomInBtn&&this.zoomInBtn.addEventListener("click",()=>this.handleZoom(25)),this.settingsBtn&&this.settingsBtn.addEventListener("click",()=>{console.log("Timeline settings clicked")}),window.addEventListener("preview-player-state-change",e=>{this.updatePlayState(e.detail.isPlaying)}),window.addEventListener("preview-player-time-update",e=>{this.updateTime(e.detail.currentTime)})}togglePlay(){const e=new CustomEvent("timeline-play-toggle");window.dispatchEvent(e)}updatePlayState(e){if(this.isPlaying=e,this.playBtn){const t=this.playBtn.querySelector(".icon");t&&(t.textContent=e?"â¸ï¸":"â–¶ï¸")}}updateTime(e){this.currentTimeDisplay&&(this.currentTimeDisplay.textContent=this.formatTime(e))}updateDuration(e){this.totalDurationDisplay&&(this.totalDurationDisplay.textContent=this.formatTime(e))}handleZoom(e){let t=this.zoomLevel+e;if(t=Math.max(25,Math.min(400,t)),t!==this.zoomLevel){this.zoomLevel=t,this.zoomLevelDisplay&&(this.zoomLevelDisplay.textContent=`${this.zoomLevel}%`),console.log(`Zoom level: ${this.zoomLevel}%`),this.updateRuler();const e=new CustomEvent("timeline-zoom-change",{detail:{zoomLevel:this.zoomLevel}});window.dispatchEvent(e)}}formatTime(e){return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}}document.addEventListener("DOMContentLoaded",()=>{window.timelineManager=new TimelineManager});