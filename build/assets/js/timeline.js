class TimelineManager{constructor(){this.playBtn=document.getElementById("timeline-play-btn"),this.currentTimeDisplay=document.getElementById("timeline-current-time"),this.totalDurationDisplay=document.getElementById("timeline-total-duration"),this.zoomOutBtn=document.getElementById("timeline-zoom-out"),this.zoomInBtn=document.getElementById("timeline-zoom-in"),this.zoomLevelDisplay=document.getElementById("timeline-zoom-level"),this.settingsBtn=document.getElementById("timeline-settings-btn"),this.ruler=document.querySelector(".timeline__ruler"),this.zoomLevel=100,this.isPlaying=!1,this.duration=60,this.pixelsPerSecond=50,this.init()}init(){this.attachEventListeners(),this.updateRuler(),console.log("TimelineManager initialized")}updateRuler(){if(this.ruler){const e=this.duration*this.pixelsPerSecond*(this.zoomLevel/100);let t=this.ruler.querySelector(".timeline__ruler-content");t||(t=document.createElement("div"),t.className="timeline__ruler-content",t.style.height="100%",this.ruler.appendChild(t)),t.style.width=`${e}px`,this.generateTimeMarkers(t)}}generateTimeMarkers(e){e.innerHTML="";const t=this.zoomLevel/100,i=this.pixelsPerSecond*t;let n=5,o=1;i<20?(n=10,o=5):i<10&&(n=30,o=10);const l=document.createDocumentFragment();for(let e=0;e<=this.duration;e+=o){const t=e*i;if(e%n===0){const i=document.createElement("div");i.className="timeline__marker",i.style.left=`${t}px`;const n=document.createElement("span");n.className="timeline__label",n.textContent=this.formatTimeLabel(e),i.appendChild(n);const o=document.createElement("div");o.className="timeline__tick timeline__tick--major",i.appendChild(o),l.appendChild(i)}else{const e=document.createElement("div");e.className="timeline__marker",e.style.left=`${t}px`;const i=document.createElement("div");i.className="timeline__tick timeline__tick--minor",e.appendChild(i),l.appendChild(e)}}e.appendChild(l)}formatTimeLabel(e){return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}attachEventListeners(){this.zoomOutBtn&&this.zoomOutBtn.addEventListener("click",()=>this.handleZoom(-25)),this.zoomInBtn&&this.zoomInBtn.addEventListener("click",()=>this.handleZoom(25)),this.settingsBtn&&this.settingsBtn.addEventListener("click",()=>{console.log("Timeline settings clicked")}),window.addEventListener("preview-player-state-change",e=>{this.updatePlayState(e.detail.isPlaying)}),window.addEventListener("preview-player-time-update",e=>{this.updateTime(e.detail.currentTime)})}togglePlay(){const e=new CustomEvent("timeline-play-toggle");window.dispatchEvent(e)}updatePlayState(e){if(this.isPlaying=e,this.playBtn){const t=this.playBtn.querySelector(".icon");t&&(t.textContent=e?"⏸️":"▶️")}}updateTime(e){this.currentTimeDisplay&&(this.currentTimeDisplay.textContent=this.formatTime(e))}updateDuration(e){this.totalDurationDisplay&&(this.totalDurationDisplay.textContent=this.formatTime(e))}handleZoom(e){let t=this.zoomLevel+e;if(t=Math.max(25,Math.min(400,t)),t!==this.zoomLevel){this.zoomLevel=t,this.zoomLevelDisplay&&(this.zoomLevelDisplay.textContent=`${this.zoomLevel}%`),console.log(`Zoom level: ${this.zoomLevel}%`);const e=new CustomEvent("timeline-zoom-change",{detail:{zoomLevel:this.zoomLevel}});window.dispatchEvent(e)}}formatTime(e){return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}}document.addEventListener("DOMContentLoaded",()=>{window.timelineManager=new TimelineManager});