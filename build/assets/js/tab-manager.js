import{modalDialog}from"./modal-dialog.js";export class TabManager{constructor(){this.tabs=[],this.maxTabs=10,this.tabContainer=document.querySelector(".tab-bar__tabs"),this.createBtn=document.querySelector('[data-action="create-tab"]'),this.notificationContainer=document.getElementById("notification-container"),this.init()}init(){this.createBtn&&this.createBtn.addEventListener("click",()=>this.createTab()),this.tabContainer&&(this.tabContainer.addEventListener("click",t=>this.handleTabClick(t)),this.tabContainer.addEventListener("keydown",t=>this.handleKeyDown(t))),0===this.tabs.length&&this.createTab()}handleTabClick(t){const e=t.target.closest(".editor-tab");if(!e)return;if(t.target.closest(".editor-tab__close")){t.stopPropagation();const a=e.dataset.tabId;return void(a&&this.closeTab(a))}const a=e.dataset.tabId;a&&this.switchTab(a)}closeTab(t){if(this.tabs.length<=1)return void this.showNotification("⚠️ Cannot close last tab","error");const e=this.tabs.find(e=>e.id===t);e&&(e.hasUnsavedChanges?this.showUnsavedDialog(e):this.performCloseTab(t))}showUnsavedDialog(t){modalDialog.show("Unsaved Changes",`Do you want to save changes to "${t.name}" before closing?`,[{text:"Save",type:"primary",callback:()=>{console.log(`Saving project: ${t.id}`),this.performCloseTab(t.id)}},{text:"Don't Save",type:"danger",callback:()=>{console.log(`Tab closed without saving: ${t.id}`),this.performCloseTab(t.id)}},{text:"Cancel",type:"secondary",callback:()=>{console.log(`Close canceled for tab: ${t.id}`)}}])}performCloseTab(t){const e=this.tabs.findIndex(e=>e.id===t);if(-1===e)return;if(this.tabs[e].isActive){let t=this.tabs[e+1]||this.tabs[e-1];t&&this.tabs.forEach(e=>e.isActive=e.id===t.id)}this.tabs.splice(e,1),this.renderTabs(),console.log(`Closed tab: ${t}`)}markTabUnsaved(t){const e=this.tabs.find(e=>e.id===t);e&&!e.hasUnsavedChanges&&(e.hasUnsavedChanges=!0,this.renderTabs())}markTabSaved(t){const e=this.tabs.find(e=>e.id===t);e&&e.hasUnsavedChanges&&(e.hasUnsavedChanges=!1,this.renderTabs())}handleKeyDown(t){const e=Array.from(this.tabContainer.querySelectorAll(".editor-tab")),a=document.activeElement,s=e.indexOf(a);if(-1===s)return;let i;switch(t.key){case"ArrowLeft":t.preventDefault(),i=s-1,i<0&&(i=e.length-1),e[i].focus();break;case"ArrowRight":t.preventDefault(),i=s+1,i>=e.length&&(i=0),e[i].focus();break;case"Enter":case" ":t.preventDefault(),this.switchTab(e[s].dataset.tabId)}}switchTab(t){const e=this.tabs.find(e=>e.id===t);e&&(e.isActive||(this.tabs.forEach(e=>e.isActive=e.id===t),this.renderTabs(),console.log(`Switched to tab: ${t}`),console.log(`Loading project data for tab: ${t}`)))}createTab(){if(this.tabs.length>=this.maxTabs)return void this.showNotification("⚠️ Maximum 10 tabs allowed","error");const t={id:crypto.randomUUID(),name:"Untitled Project",isActive:!0,createdAt:Date.now()};this.tabs.forEach(t=>t.isActive=!1),this.tabs.push(t),this.renderTabs(),console.log(`Created tab: ${t.id}`)}renderTabs(){this.tabContainer.innerHTML="",this.tabs.forEach(t=>{const e=document.createElement("div");e.className=`editor-tab ${t.isActive?"active":""} ${t.hasUnsavedChanges?"unsaved":""}`,e.dataset.tabId=t.id,e.setAttribute("role","tab"),e.setAttribute("aria-selected",t.isActive),e.setAttribute("aria-label",`Tab: ${t.name}`),e.tabIndex=0,e.innerHTML=`\n                <span class="editor-tab__name">${t.name}</span>\n                <button class="editor-tab__close" aria-label="Close tab" data-tab-close tabindex="-1">\n                    ×\n                </button>\n            `,this.tabContainer.appendChild(e)});const t=this.tabContainer.querySelector(".active");t&&t.scrollIntoView({behavior:"smooth",block:"nearest"})}showNotification(t,e="info"){const a=document.createElement("div");a.className=`notification notification--${e}`;const s="error"===e?"⚠️":"ℹ️";a.innerHTML=`\n            <span class="notification__icon">${s}</span>\n            <span class="notification__message">${t}</span>\n        `,this.notificationContainer.appendChild(a),setTimeout(()=>{a.style.animation="slideOutRight 0.3s ease-in forwards",a.addEventListener("animationend",()=>{a.remove()})},3e3)}}document.addEventListener("DOMContentLoaded",()=>{window.tabManager=new TabManager});