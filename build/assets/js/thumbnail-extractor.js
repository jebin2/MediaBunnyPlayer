class ThumbnailExtractor{constructor(){this.cache=new Map,this.pending=new Map}getThumbnail(e){return this.cache.has(e)?this.cache.get(e):(this.pending.has(e)||this.extractThumbnail(e),null)}async extractThumbnail(e){if(this.pending.has(e))return this.pending.get(e);const t=(async()=>{try{if(!window.indexedDBHelper)return console.error("IndexedDBHelper not available"),null;const t=await window.indexedDBHelper.getMedia(e);if(!t||!t.type.startsWith("video"))return null;const n=await this.generateThumbnail(t.file||t.blob);if(n){this.cache.set(e,n);const t=new CustomEvent("thumbnail-ready",{detail:{mediaId:e,thumbnail:n}});window.dispatchEvent(t)}return n}catch(e){return console.error("Error extracting thumbnail:",e),null}finally{this.pending.delete(e)}})();return this.pending.set(e,t),t}generateThumbnail(e){return new Promise((t,n)=>{if(!e)return void n(new Error("No file provided"));const r=document.createElement("video");r.preload="metadata",r.muted=!0,r.playsInline=!0;const a=URL.createObjectURL(e);r.src=a,r.onloadeddata=()=>{r.currentTime=.1},r.onseeked=()=>{try{const e=document.createElement("canvas");e.width=160,e.height=90;e.getContext("2d").drawImage(r,0,0,e.width,e.height);const n=e.toDataURL("image/jpeg",.7);t(n)}catch(e){n(e)}finally{URL.revokeObjectURL(a),r.remove()}},r.onerror=e=>{URL.revokeObjectURL(a),n(new Error("Video load error"))}})}}window.thumbnailExtractor=new ThumbnailExtractor;export default window.thumbnailExtractor;