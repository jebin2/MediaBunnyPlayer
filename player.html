<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Media Player</title>
	<link rel="manifest" href="manifest.json">
	<link rel="stylesheet" href="./css/style.css">
	<meta name="theme-color" content="#1a1a35">
	<link rel="icon" type="image/x-icon" href="favicon.ico">
</head>

<body>
	<div class="entryloading" id="entryloading"></div>
	<div class="app-container">
		<div class="header">
			<div class="logo" style="text-align: center;">
				<img src="favicon.ico" alt="Logo" style="width: 40px; height: 40px; vertical-align: middle;" />

				<div style="display: inline-block; text-align: left; margin-left: 8px;">
					<div style="font-size: 1.5em; font-weight: bold;">
						Media Player
					</div>
					<div style="font-size: 0.85em; color: gray; margin-top: 2px;">
						Powered by <strong>MediaBunny</strong>
					</div>
				</div>
			</div>

			<div class="controls-header">
				<div class="split-btn-group" id="openActionsContainer">
					<button class="btn" id="mainActionBtn">Open File</button>
					<button class="btn btn-dropdown" id="dropdownActionBtn" title="More open options">‚ñº</button>
				</div>

				<!-- This is the popup menu -->
				<div class="action-dropdown-menu hidden" id="actionDropdownMenu">
					<button class="btn" data-action="open-url">Open URL</button>
					<button class="btn" data-action="open-file">Open File</button>
					<button class="btn" data-action="add-file">Add File(s)</button>
					<button class="btn" data-action="add-folder">Add Folder</button>
				</div>

				<!-- New Split Button for Playlist -->
				<div class="split-btn-group">
					<button class="btn" id="togglePlaylistBtn">Playlist</button>
					<button class="btn" id="clearPlaylistBtn" title="Clear Playlist">&times;</button>
				</div>
				<button class="btn" id="settingsHeaderBtn" title="Settings & Tools">
					<span style="margin-right: 0.5rem;">‚öôÔ∏è</span>
					Settings
				</button>
			</div>
			<div class="recording-controls-container hidden" id="recordingControls">
				<button class="btn" id="startRecFloatingBtn">‚ñ∂Ô∏è Start</button>
				<span id="recTimer" class="btn">00:00</span>
				<button class="btn" id="pauseRecBtn">‚è∏Ô∏è Pause</button>
				<button class="btn" id="stopRecBtn">‚èπÔ∏è Stop</button>
				<p id="guideinforec">Press 'L' to lock/unlock the selection area. Then other element will be
					interactable</p>
			</div>
		</div>

		<div class="player-area" id="playerArea">
			<div class="drop-zone" id="dropZone">
				<div class="drop-zone-content">
					<img src="upload.svg" />
					<h2>Drop media files here</h2>
					<button class="btn btn-primary" id="chooseFileBtn">Choose Files</button>
				</div>
			</div>
			<div class="video-container" id="videoContainer">
				<canvas class="video-canvas" id="videoCanvas"></canvas>
				<canvas id="cropCanvas" class="hidden"></canvas>
				<div class="video-controls" id="videoControls">
					<div class="progress-container" id="progressContainer">
						<div class="progress-bar" id="progressBar"></div>
						<div class="progress-handle" id="progressHandle"></div>
						<!-- New Preview Element -->
						<div id="seekPreview" class="hidden">
							<canvas id="seekPreviewCanvas" width="160" height="90"></canvas>
							<span id="seekPreviewTime">00:00</span>
						</div>
					</div>
					<div class="controls-bottom">
						<div class="controls-left">
							<button class="play-btn" id="prevBtn" title="Previous">‚èÆ</button>
							<button class="play-btn" id="playBtn">‚ñ∂</button>
							<button class="play-btn" id="nextBtn" title="Next">‚è≠</button>
							<div class="time-display" id="timeDisplay">00:00 / 00:00</div>
							<div class="playback-speed-container">
								<input id="playbackSpeedInput" class="speed-input" min="0.25" max="4" value="1">
							</div>
						</div>
						<div class="controls-right">
							<div class="track-controls">
								<button class="btn track-btn" id="audioTrackCtrlBtn" title="Audio Tracks">üîä</button>
								<button class="btn track-btn" id="subtitleTrackCtrlBtn" title="Subtitles">CC</button>
							</div>

							<!-- Add these dropdown menus after the video-controls div: -->
							<div class="track-menu hidden" id="audioTrackMenu">
								<div class="track-menu-content">
									<h4>Audio Tracks</h4>
									<ul id="audioTrackList"></ul>
								</div>
							</div>

							<div class="track-menu hidden" id="subtitleTrackMenu">
								<div class="track-menu-content">
									<h4>Subtitle Tracks</h4>
									<ul id="subtitleTrackList">
										<li class="track-item" data-track-id="none">
											<span>None</span>
										</li>
									</ul>
								</div>
							</div>
							<div class="volume-container">
								<button class="btn" id="muteBtn">üîä</button>
								<input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.01"
									value="0.7">
							</div>
							<button class="fullscreen-btn" id="fullscreenBtn">‚õ∂</button>
						</div>
					</div>
				</div>
			</div>
			<div class="url-play-overlay hidden" id="urlPlayOverlay">
				<div class="play-button-overlay">‚ñ∂</div>
				<p>Click to play video</p>
			</div>
			<div class="sidebar hidden" id="sidebar">
				<div id="playlistContent"></div>
			</div>


			<!-- START: New Location for Settings Menu -->
			<div class="sidebar hidden" id="settingsMenu">
				<div class="track-menu-content">

					<!-- Section 1: Playback Settings -->
					<h4>Playback</h4>
					<!-- <div class="trim-option">
						<input type="checkbox" id="autoplayToggle" checked>
						<label for="autoplayToggle">Autoplay Next Video</label>
					</div> -->
					<div class="toggle-option" id="autoplayToggleContainer">
						<label for="autoplayToggle">
							<span>Autoplay Next Video</span>
							<div class="toggle-switch">
								<input type="checkbox" id="autoplayToggle" checked>
								<span class="switch-slider"></span>
							</div>
						</label>
					</div>
					<hr class="menu-divider">

					<!-- Section 2: Clipping & Trim Selection -->
					<h4>Trim Range</h4>
					<div class="trim-menu-controls">
						<input type="text" id="startTime" class="time-input" placeholder="00:00" title="Start Time">
						<span>-</span>
						<input type="text" id="endTime" class="time-input" placeholder="00:00" title="End Time">
					</div>
					<hr class="menu-divider">

					<!-- Section 3: Primary Actions & Tools -->
					<h4>Actions</h4>
					<div class="trim-menu-actions">
						<button id="loopBtn" class="control-btn track-btn btn">Loop</button>
						<button id="screenshotBtn" class="control-btn track-btn btn">Screenshot</button>
						<button id="resizeBtn" class="control-btn track-btn btn">Resize</button>
						<button id="imageToVideoBtn" class="control-btn track-btn btn">Image to Video</button>
						<button id="recordScreenBtn" class="control-btn track-btn btn">Record Screen</button>
					</div>

					<hr class="menu-divider">

					<!-- Section 4: Advanced Cropping Tools -->
					<h4>Cropping</h4>
					<div class="trim-menu-actions crop">
						<button id="cropBtn" class="control-btn track-btn btn hidden">‚úÇÔ∏è</button>
						<button id="panScanBtn" class="control-btn track-btn btn">Dynamic ‚úÇÔ∏è</button>
						<button class="btn control-btn track-btn" id="fixSizeBtn" style="display: none;">Fix
							Size</button>
					</div>

					<!-- Dynamic options are now correctly grouped under the main Cropping section -->
					<div id="dynamicCropOptionsContainer">
						<fieldset class="trim-mode-selector">
							<legend>Aspect Ratio</legend>
							<div class="aspect-ratio-group" id="aspectRatioBtnGroup">
								<button class="btn aspect-ratio-btn active" data-value="custom"
									title="Custom Ratio"></button>
								<button class="btn aspect-ratio-btn" data-value="16:9" title="16:9 Ratio">16:9</button>
								<button class="btn aspect-ratio-btn" data-value="9:16" title="9:16 Ratio">9:16</button>
							</div>
						</fieldset>
						<!-- START: Updated Dynamic Crop Options UI -->
						<div id="dynamicCropOptionsContainer">

							<fieldset class="trim-mode-selector">
								<legend>Dynamic Crop Mode</legend>

								<!-- 1. Segmented Control for Main Crop Mode -->
								<div class="segmented-control" id="cropModeBtnGroup">
									<button class="btn active" data-value="none">Default</button>
									<button class="btn" data-value="spotlight">Spotlight</button>
									<button class="btn" data-value="max-size">Max Size</button>
								</div>

								<!-- Divider for visual separation -->
								<hr class="menu-divider" style="margin: 5px 0;">

								<!-- 2. Toggle Switches for Sub-Options (Now inside the fieldset) -->
								<!-- START: Updated Toggle List HTML -->
								<div class="toggle-options-list">

									<div class="toggle-option" id="scaleOptionContainer" style="display: none;">
										<label for="scaleWithRatioToggle">
											<span>Scale to Fit</span>
											<div class="toggle-switch">
												<input type="checkbox" id="scaleWithRatioToggle">
												<span class="switch-slider"></span>
											</div>
										</label>
									</div>

									<div class="toggle-option" id="smoothOptionContainer" style="display: none;">
										<label for="smoothPathToggle">
											<span>Smooth Crop Movement</span>
											<div class="toggle-switch">
												<input type="checkbox" id="smoothPathToggle" checked>
												<span class="switch-slider"></span>
											</div>
										</label>
									</div>

									<div class="toggle-option" id="blurOptionContainer" style="display: none;">
										<label for="blurBackgroundToggle">
											<span>Blurred Background</span>
											<div class="toggle-switch">
												<input type="checkbox" id="blurBackgroundToggle">
												<span class="switch-slider"></span>
											</div>
										</label>
										<!-- The input remains outside the label to avoid layout issues -->
										<input id="blurAmountInput" class="speed-input" value="15" min="1" max="100"
											title="Blur amount in pixels">
									</div>

								</div>
								<!-- END: Updated Toggle List HTML -->

							</fieldset>

						</div>
						<!-- END: Updated Dynamic Crop Options UI -->
					</div>

					<hr class="menu-divider">

					<!-- Section 5: Global Reset Action -->
					<!-- Moved to the end of the menu for better clarity -->
					<div class="trim-menu-actions">
						<button class="control-btn track-btn btn" id="resetAllBtn">Reset All</button>
						<button id="cutBtn" class="control-btn track-btn btn" title="Press 'C' to Process">Process
							Clip</button>
					</div>

				</div>
			</div>
		</div>
		<div class="loading hidden" id="loading">
			<div class="spinner"></div>
			<div id="statusMessage"></div>
		</div>
	</div>
	<div class="screenshot-overlay hidden" id="screenshotOverlay">
		<div class="screenshot-modal">
			<button class="close-btn" id="closeScreenshotBtn">&times;</button>
			<h3>Screenshot Preview</h3>
			<img id="screenshotPreviewImg" src="" alt="Screenshot Preview">
			<div class="screenshot-actions">
				<button class="btn" id="copyScreenshotBtn">Copy Image</button>
				<button class="btn" id="downloadScreenshotBtn">Download</button>
			</div>
		</div>
	</div>
	<!-- Image to Video Modal -->
	<div class="screenshot-overlay hidden" id="imageToVideoModal">
		<div class="screenshot-modal">
			<button class="close-btn" id="closeImageToVideoBtn">&times;</button>
			<h3>Create Video from Image</h3>
			<p>Upload an image and set the duration to create a video clip.</p>

			<div class="resize-controls">
				<div class="resize-section">
					<h4>Select Image</h4>
					<input type="file" id="imageFileInput" accept="image/*" style="display: none;">
					<button class="btn" id="selectImageBtn">Choose Image</button>
					<div id="imagePreviewContainer" style="margin-top: 1rem; display: none;">
						<img id="imagePreview"
							style="max-width: 100%; max-height: 230px; border-radius: 8px; border: 1px solid var(--glass-border);" />
					</div>
				</div>

				<div class="resize-section">
					<h4>Duration (seconds)</h4>
					<input id="imageDurationInput" class="speed-input" min="1" max="300" value="5"
						placeholder="Duration in seconds">
				</div>
				<div class="resize-section">
					<h4>Dimensions</h4>
					<div class="dimension-controls">
						<input id="imageVideoWidthInput" class="speed-input" placeholder="Width">
						<span>√ó</span>
						<input id="imageVideoHeightInput" class="speed-input" placeholder="Height">
					</div>
					<div class="trim-option">
						<input type="checkbox" id="imageVideoKeepRatio" checked>
						<label for="imageVideoKeepRatio">Keep Aspect Ratio</label>
					</div>
				</div>

				<div class="resize-section">
					<h4>Optional</h4>
					<input type="file" id="imageVideoAudioInput" accept="audio/*" style="display: none;">
					<div class="split-btn-group" style="width: fit-content;">
						<button class="btn" id="removeAudio" title="Clear Audio">&times;</button>
						<button class="btn" id="imageVideoAudioBtn">Choose Audio</button>
						<span id="audioFileName" class="hidden btn"></span>
					</div>
				</div>
			</div>

			<div class="screenshot-actions">
				<button class="btn" id="cancelImageToVideoBtn">Cancel</button>
				<button class="btn" id="createImageVideoBtn" disabled>Create Video</button>
			</div>
		</div>
	</div>
	<div class="screenshot-overlay hidden" id="urlModal">
		<div class="screenshot-modal">
			<h3>Enter Video URL</h3>
			<p>Enter the direct URL to a video file (e.g., MP4, WebM).</p>
			<input type="url" id="urlInput" class="speed-input url-class" placeholder="https://example.com/video.mp4">
			<div class="screenshot-actions">
				<button class="btn" id="cancelUrlBtn">Cancel</button>
				<button class="btn" id="loadUrlBtn">Load</button>
			</div>
		</div>
	</div>
	<div class="screenshot-overlay hidden" id="resizeModal">
		<div class="screenshot-modal">
			<h3>Resize Video</h3>
			<p>Select a trim range and new dimensions for the clip.</p>

			<div class="resize-controls">
				<div class="resize-section">
					<h4>Trim Range</h4>
					<div class="trim-menu-controls">
						<input type="text" id="resizeStartTime" class="time-input" placeholder="00:00"
							title="Start Time">
						<span>-</span>
						<input type="text" id="resizeEndTime" class="time-input" placeholder="00:00" title="End Time">
					</div>
				</div>

				<div class="resize-section">
					<h4>Dimensions</h4>
					<div class="dimension-controls">
						<input id="resizeWidthInput" class="speed-input" placeholder="Width">
						<span>&times;</span>
						<input id="resizeHeightInput" class="speed-input" placeholder="Height">
					</div>
					<div class="trim-option">
						<input type="checkbox" id="keepRatioToggle" checked>
						<label for="keepRatioToggle">Keep Aspect Ratio</label>
					</div>
				</div>
			</div>

			<div class="screenshot-actions">
				<button class="btn" id="cancelResizeBtn">Cancel</button>
				<button class="btn" id="processResizeBtn">Resize</button>
			</div>
		</div>
	</div>
	<div class="screenshot-overlay hidden" id="recordingModeModal">
		<div class="screenshot-modal">
			<h3>Choose Recording Mode</h3>
			<p style="margin: 1rem 0; color: #ccc;">How would you like to record?</p>

			<!-- START: Added Shortcut Information -->
			<div class="shortcut-info"
				style="margin-bottom: 1.5rem; text-align: left; font-size: 0.9em; background: rgba(0,0,0,0.2); padding: 10px 15px; border-radius: 8px;">
				<ul class="shortcut-list" style="padding-left: 0; margin: 0;">
					<li>
						<span>During *any* recording, press <kbd>H</kbd> to hide/show the controls.</span>
					</li>
					<li style="margin-top: 8px;">
						<span>When cropping, press <kbd>L</kbd> to lock/unlock the selection area.</span>
					</li>
				</ul>
			</div>
			<!-- END: Added Shortcut Information -->

			<div class="screenshot-actions" style="justify-content: center; gap: 15px;">
				<button class="btn" id="recordFullAreaBtn">Record Full Area</button>
				<button class="btn" id="selectCropAreaBtn">Select & Crop Area</button>
			</div>

			<div class="screenshot-actions" style="margin-top: 1.5rem; justify-content: center;">
				<button class="btn" id="cancelRecordingBtn" style="background-color: #6e3c3c;">Cancel</button>
			</div>
		</div>
	</div>
	<div class="shortcut-keys-panel hidden" id="shortcutKeysPanel">
		<ul class="shortcut-list">
			<li><span>Draw a rectangle and press <kbd>l</kbd> to fix the crop size. Crop will move along the cursor or
					keep cursor as it is for static crop. Finally Press <kbd>r</kbd> to lock its position. or continue
					moving until video end. Finally press <kbd>c</kbd> to create the video.</span></li>
			<li><kbd>n</kbd><span>Move to Next Frame(on pause)</span></li>
			<li><kbd>p</kbd><span>Move to Previous Frame(on pause)</span></li>
			<li><kbd>s</kbd><span>Take Screenshot</span></li>
			<li><kbd>l</kbd><span>Lock Crop Size and Start Recording</span></li>
			<li><kbd>r</kbd><span>To lock its position.</span></li>
			<li><kbd>Shift</kbd> + <kbd>Scroll</kbd><span>Zoom In / Out (while moving)</span></li>
			<li><kbd>c</kbd><span>To Process the clip</span></li>
			<li><kbd>Esc</kbd><span>To Reset All</span></li>
		</ul>
	</div>
	<div class="shortcut-keys-panel guide_panel hidden" id="guide_panel">
		<ul class="shortcut-list">
			<span id="guide_info">
				Hello Welcome
			</span>
		</ul>
	</div>
	<div class="showMessage hidden" id="showMessage">
	</div>
	<input type="file" id="fileInput" multiple accept="video/*,audio/*,.mkv,.webm">
	<input type="file" id="folderInput" webkitdirectory multiple>
	<script type="module">
		document.addEventListener('DOMContentLoaded', () => {
			const urlParams = new URLSearchParams(window.location.search);
			const modular = urlParams.get('modular') !== 'true';

			if (modular) {
				import('./js/main.js')
					.then(module => {
						console.log('Loaded main.js');
					})
					.catch(err => {
						console.error('Failed to load main.js', err);
					});
			} else {
				import('./script.js')
					.then(module => {
						console.log('Loaded script.js');
					})
					.catch(err => {
						console.error('Failed to load script.js', err);
					});
			}
		});
	</script>


</body>

</html>